<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆìŒë´„ - LangChain Agent í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1rem;
        }

        .input-section textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s;
        }

        .input-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .pipeline-section {
            margin-top: 30px;
        }

        .pipeline-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tool-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .tool-card.processing {
            border-left-color: #ffa726;
            animation: pulse 1.5s infinite;
        }

        .tool-card.success {
            border-left-color: #66bb6a;
        }

        .tool-card.error {
            border-left-color: #ef5350;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .tool-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .tool-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-time {
            font-size: 0.75rem;
            color: #999;
            font-weight: normal;
        }

        .status-pending {
            background: #e0e0e0;
            color: #666;
        }

        .status-processing {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
        }

        .tool-content {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }

        .tool-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .emotion-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .emotion-item.primary {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        }

        .emotion-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .emotion-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .emotion-intensity {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .intensity-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
        }

        .intensity-dot.active {
            background: #667eea;
        }

        .ai-response {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            border: 2px solid #667eea;
        }

        .ai-response-label {
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .ai-response-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #333;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .icon {
            font-size: 1.3rem;
        }

        .meta-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .meta-item strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¸ ë§ˆìŒë´„ - LangChain Agent</h1>
            <p>STT â†’ ê°ì • ë¶„ì„ â†’ AI ì‘ë‹µ ìƒì„± íŒŒì´í”„ë¼ì¸</p>
        </div>

        <div class="main-card">
            <div class="input-section">
                <label for="userInput">ì‚¬ìš©ì ì…ë ¥ (í…ìŠ¤íŠ¸)</label>
                <textarea 
                    id="userInput" 
                    placeholder="ì˜ˆ: ì˜¤ëŠ˜ í•˜ë£¨ ì •ë§ í˜ë“¤ì—ˆì–´ìš”. ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ê³  ê¸°ìš´ì´ ì—†ë„¤ìš”."
                ></textarea>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="runBtn" onclick="runAgent()">
                    ğŸš€ Agent ì‹¤í–‰
                </button>
                <button class="btn btn-secondary" onclick="clearResults()">
                    ğŸ”„ ì´ˆê¸°í™”
                </button>
            </div>

            <div class="pipeline-section" id="pipelineSection" style="display: none;">
                <div class="pipeline-title">ğŸ“Š ì‹¤í–‰ íŒŒì´í”„ë¼ì¸</div>

                <!-- STT Tool -->
                <div class="tool-card" id="sttCard">
                    <div class="tool-header">
                        <div class="tool-name">
                            <span class="icon">ğŸ¤</span>
                            <span>1. Speech-to-Text (STT)</span>
                        </div>
                        <div class="tool-status status-pending" id="sttStatus">ëŒ€ê¸° ì¤‘</div>
                    </div>
                    <div class="tool-content" id="sttContent" style="display: none;"></div>
                </div>

                <!-- Emotion Analysis Tool -->
                <div class="tool-card" id="emotionCard">
                    <div class="tool-header">
                        <div class="tool-name">
                            <span class="icon">ğŸ’­</span>
                            <span>2. Emotion Analysis</span>
                        </div>
                        <div class="tool-status status-pending" id="emotionStatus">ëŒ€ê¸° ì¤‘</div>
                    </div>
                    <div class="tool-content" id="emotionContent" style="display: none;"></div>
                </div>

                <!-- LLM Response Tool -->
                <div class="tool-card" id="llmCard">
                    <div class="tool-header">
                        <div class="tool-name">
                            <span class="icon">ğŸ¤–</span>
                            <span>3. LLM Response (GPT-4o-mini)</span>
                        </div>
                        <div class="tool-status status-pending" id="llmStatus">ëŒ€ê¸° ì¤‘</div>
                    </div>
                    <div class="tool-content" id="llmContent" style="display: none;"></div>
                </div>

                <!-- Future Tools Placeholder -->
                <div class="tool-card" style="opacity: 0.5; border-left-color: #ccc;">
                    <div class="tool-header">
                        <div class="tool-name">
                            <span class="icon">ğŸ“…</span>
                            <span>4. Routine Recommend (ì˜ˆì •)</span>
                        </div>
                        <div class="tool-status status-pending">ì¤€ë¹„ ì¤‘</div>
                    </div>
                </div>

                <div class="tool-card" style="opacity: 0.5; border-left-color: #ccc;">
                    <div class="tool-header">
                        <div class="tool-name">
                            <span class="icon">ğŸ¥</span>
                            <span>5. Health Advisor (ì˜ˆì •)</span>
                        </div>
                        <div class="tool-status status-pending">ì¤€ë¹„ ì¤‘</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent Memory Section -->
        <div class="main-card" id="memorySection" style="display: none;">
            <div class="pipeline-title">ğŸ’¾ Agent Memory (ëŒ€í™” íˆìŠ¤í† ë¦¬)</div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadMemory()" style="flex: 0 0 auto;">
                    ğŸ”„ ë©”ëª¨ë¦¬ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>

            <div id="memoryContent">
                <div style="text-align: center; padding: 40px; color: #999;">
                    ë©”ëª¨ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ "ë©”ëª¨ë¦¬ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSessionId = 'web_session_' + Date.now();
        let timers = {
            stt: { start: 0, end: 0 },
            emotion: { start: 0, end: 0 },
            llm: { start: 0, end: 0 }
        };

        async function runAgent() {
            const userInput = document.getElementById('userInput').value.trim();
            
            if (!userInput) {
                alert('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // UI ì´ˆê¸°í™”
            document.getElementById('pipelineSection').style.display = 'block';
            document.getElementById('runBtn').disabled = true;
            resetToolCards();

            try {
                // 1. STT ì‹œë®¬ë ˆì´ì…˜ (í…ìŠ¤íŠ¸ ë”ë¯¸ ì…ë ¥)
                await simulateSTT(userInput);

                // 2. Agent API í˜¸ì¶œ
                await callAgentAPI(userInput);

                // 3. ë©”ëª¨ë¦¬ ìë™ ë¡œë“œ
                await loadMemory();

            } catch (error) {
                console.error('Error:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                document.getElementById('runBtn').disabled = false;
            }
        }

        async function simulateSTT(text) {
            timers.stt.start = performance.now();
            updateToolStatus('stt', 'processing', 'ì²˜ë¦¬ ì¤‘...');
            
            // ì‹œë®¬ë ˆì´ì…˜ ë”œë ˆì´
            await new Promise(resolve => setTimeout(resolve, 500));
            
            timers.stt.end = performance.now();
            const duration = Math.round(timers.stt.end - timers.stt.start);
            
            const sttResult = {
                input: text,
                method: 'text_dummy',
                note: 'í˜„ì¬ëŠ” í…ìŠ¤íŠ¸ ë”ë¯¸ ì…ë ¥ ë°©ì‹ (ì¶”í›„ ìŒì„± ì…ë ¥ìœ¼ë¡œ ë³€ê²½ ì˜ˆì •)',
                duration: duration
            };
            
            updateToolStatus('stt', 'success', 'ì™„ë£Œ', duration);
            displaySTTResult(sttResult);
        }

        async function callAgentAPI(text) {
            // Emotion Analysis ì‹œì‘
            timers.emotion.start = performance.now();
            updateToolStatus('emotion', 'processing', 'ë¶„ì„ ì¤‘...');
            
            // LLMë„ í•¨ê»˜ ì‹œì‘ (API í˜¸ì¶œì— í¬í•¨ë˜ë¯€ë¡œ)
            timers.llm.start = performance.now();
            
            try {
                const apiStartTime = performance.now();
                const response = await fetch('http://localhost:8000/api/agent/text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_text: text,
                        session_id: currentSessionId
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const apiEndTime = performance.now();
                const totalApiTime = Math.round(apiEndTime - apiStartTime);
                
                // Emotion Analysis ì™„ë£Œ
                timers.emotion.end = apiStartTime + (totalApiTime * 0.6);
                const emotionDuration = Math.round(timers.emotion.end - timers.emotion.start);
                updateToolStatus('emotion', 'success', 'ì™„ë£Œ', emotionDuration);
                displayEmotionResult(result.emotion_result, emotionDuration);

                // LLM Response ì™„ë£Œ
                updateToolStatus('llm', 'processing', 'ìƒì„± ì¤‘...');
                await new Promise(resolve => setTimeout(resolve, 100));
                timers.llm.end = apiEndTime;
                const llmDuration = Math.round(timers.llm.end - timers.llm.start);
                updateToolStatus('llm', 'success', 'ì™„ë£Œ', llmDuration);
                displayLLMResult(result, llmDuration);

            } catch (error) {
                updateToolStatus('emotion', 'error', 'ì˜¤ë¥˜');
                updateToolStatus('llm', 'error', 'ì˜¤ë¥˜');
                throw error;
            }
        }

        function updateToolStatus(tool, status, text, duration = null) {
            const card = document.getElementById(`${tool}Card`);
            const statusEl = document.getElementById(`${tool}Status`);
            
            // ì¹´ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
            card.className = 'tool-card';
            if (status === 'processing') {
                card.classList.add('processing');
            } else if (status === 'success') {
                card.classList.add('success');
            } else if (status === 'error') {
                card.classList.add('error');
            }

            // ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            statusEl.className = 'tool-status';
            statusEl.classList.add(`status-${status}`);
            
            // ì‹œê°„ ì •ë³´ í¬í•¨
            if (duration !== null && status === 'success') {
                statusEl.innerHTML = `
                    <span>${text}</span>
                    <span class="tool-time">(${duration}ms)</span>
                `;
            } else {
                statusEl.textContent = text;
            }
        }

        function displaySTTResult(result) {
            const content = document.getElementById('sttContent');
            content.style.display = 'block';
            content.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>ì…ë ¥ í…ìŠ¤íŠ¸:</strong>
                    <div style="margin-top: 8px; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                        ${result.input}
                    </div>
                </div>
                <div class="meta-info">
                    <div class="meta-item">
                        <span>ğŸ“</span>
                        <span><strong>ì…ë ¥ ë°©ì‹:</strong> ${result.method}</span>
                    </div>
                    <div class="meta-item">
                        <span>â±ï¸</span>
                        <span><strong>ì²˜ë¦¬ ì‹œê°„:</strong> ${result.duration}ms</span>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 8px; font-size: 0.85rem; color: #f57c00;">
                    â„¹ï¸ ${result.note}
                </div>
            `;
        }

        function displayEmotionResult(emotion, duration) {
            const content = document.getElementById('emotionContent');
            content.style.display = 'block';
            
            const primary = emotion.primary_emotion;
            const secondary = emotion.secondary_emotions || [];
            
            // ê°•ë„ í‘œì‹œ ìƒì„±
            const intensityDots = (intensity) => {
                let dots = '';
                for (let i = 1; i <= 5; i++) {
                    dots += `<div class="intensity-dot ${i <= intensity ? 'active' : ''}"></div>`;
                }
                return dots;
            };

            content.innerHTML = `
                <div class="emotion-grid">
                    <div class="emotion-item primary">
                        <div class="emotion-label">ì£¼ìš” ê°ì •</div>
                        <div class="emotion-value">${primary.name_ko}</div>
                        <div class="emotion-intensity">${intensityDots(primary.intensity)}</div>
                        <div style="margin-top: 8px; font-size: 0.85rem; color: #666;">
                            ì‹ ë¢°ë„: ${(primary.confidence * 100).toFixed(0)}%
                        </div>
                    </div>
                    
                    <div class="emotion-item">
                        <div class="emotion-label">ì „ì²´ ê°ì •</div>
                        <div class="emotion-value" style="color: ${emotion.sentiment_overall === 'positive' ? '#66bb6a' : emotion.sentiment_overall === 'negative' ? '#ef5350' : '#ffa726'}">
                            ${emotion.sentiment_overall === 'positive' ? 'ê¸ì •ì ' : emotion.sentiment_overall === 'negative' ? 'ë¶€ì •ì ' : 'ì¤‘ë¦½'}
                        </div>
                    </div>
                    
                    <div class="emotion-item">
                        <div class="emotion-label">ìœ„í—˜ ìˆ˜ì¤€</div>
                        <div class="emotion-value" style="font-size: 1.1rem;">
                            ${emotion.service_signals.risk_level === 'normal' ? 'ğŸ˜Š ì •ìƒ' : 
                              emotion.service_signals.risk_level === 'watch' ? 'ğŸ‘€ ê´€ì°°' :
                              emotion.service_signals.risk_level === 'alert' ? 'âš ï¸ ì£¼ì˜' : 'ğŸš¨ ìœ„í—˜'}
                        </div>
                    </div>
                </div>

                ${secondary.length > 0 ? `
                <div style="margin-top: 15px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #666;">ë³´ì¡° ê°ì •</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${secondary.map(em => `
                            <div style="padding: 8px 15px; background: white; border-radius: 20px; border: 1px solid #e0e0e0;">
                                ${em.name_ko} (ê°•ë„: ${em.intensity})
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                <div class="meta-info">
                    <div class="meta-item">
                        <span>ğŸ’¡</span>
                        <span><strong>ì¶”ì²œ ì‘ë‹µ:</strong> ${emotion.recommended_response_style[0]}</span>
                    </div>
                    <div class="meta-item">
                        <span>ğŸƒ</span>
                        <span><strong>ì¶”ì²œ ë£¨í‹´:</strong> ${emotion.recommended_routine_tags.join(', ')}</span>
                    </div>
                    <div class="meta-item">
                        <span>â±ï¸</span>
                        <span><strong>ë¶„ì„ ì‹œê°„:</strong> ${duration}ms</span>
                    </div>
                </div>
            `;
        }

        function displayLLMResult(result, duration) {
            const content = document.getElementById('llmContent');
            content.style.display = 'block';
            
            // ì „ì²´ ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
            const totalTime = timers.stt.end - timers.stt.start + 
                            timers.emotion.end - timers.emotion.start + 
                            timers.llm.end - timers.llm.start;
            
            content.innerHTML = `
                <div class="ai-response">
                    <div class="ai-response-label">ğŸŒ¸ AI ë´„ì´ì˜ ì‘ë‹µ</div>
                    <div class="ai-response-text">${result.reply_text}</div>
                </div>

                <div class="meta-info">
                    <div class="meta-item">
                        <span>ğŸ¤–</span>
                        <span><strong>ëª¨ë¸:</strong> ${result.meta.model}</span>
                    </div>
                    <div class="meta-item">
                        <span>ğŸ”§</span>
                        <span><strong>ì‚¬ìš©ëœ ë„êµ¬:</strong> ${result.meta.used_tools.join(', ')}</span>
                    </div>
                    <div class="meta-item">
                        <span>â±ï¸</span>
                        <span><strong>ì‘ë‹µ ìƒì„±:</strong> ${duration}ms</span>
                    </div>
                    <div class="meta-item">
                        <span>â°</span>
                        <span><strong>ì „ì²´ ì‹œê°„:</strong> ${Math.round(totalTime)}ms</span>
                    </div>
                    <div class="meta-item">
                        <span>ğŸ†”</span>
                        <span><strong>ì„¸ì…˜:</strong> ${result.meta.session_id}</span>
                    </div>
                </div>
            `;
        }

        function resetToolCards() {
            ['stt', 'emotion', 'llm'].forEach(tool => {
                updateToolStatus(tool, 'pending', 'ëŒ€ê¸° ì¤‘', null);
                document.getElementById(`${tool}Content`).style.display = 'none';
                timers[tool] = { start: 0, end: 0 };
            });
        }

        function clearResults() {
            document.getElementById('userInput').value = '';
            document.getElementById('pipelineSection').style.display = 'none';
            currentSessionId = 'web_session_' + Date.now();
        }

        async function loadMemory() {
            const memorySection = document.getElementById('memorySection');
            const memoryContent = document.getElementById('memoryContent');
            
            memorySection.style.display = 'block';
            memoryContent.innerHTML = '<div style="text-align: center; padding: 20px;">ë¡œë”© ì¤‘...</div>';
            
            try {
                const response = await fetch(`http://localhost:8000/api/agent/memory/${currentSessionId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                displayMemory(data);
                
            } catch (error) {
                console.error('Error loading memory:', error);
                memoryContent.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #ef5350;">
                        âŒ ë©”ëª¨ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
                    </div>
                `;
            }
        }

        function displayMemory(data) {
            const memoryContent = document.getElementById('memoryContent');
            
            if (data.message_count === 0) {
                memoryContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        í˜„ì¬ ì„¸ì…˜ì— ì €ì¥ëœ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <strong>ì„¸ì…˜ ID:</strong> ${data.session_id}<br>
                    <strong>ë©”ì‹œì§€ ê°œìˆ˜:</strong> ${data.message_count}ê°œ
                </div>
            `;
            
            data.messages.forEach((msg, index) => {
                const isUser = msg.role === 'user';
                const bgColor = isUser ? '#e3f2fd' : '#f3e5f5';
                const icon = isUser ? 'ğŸ‘¤' : 'ğŸ¤–';
                const roleName = isUser ? 'ì‚¬ìš©ì' : 'AI ë´„ì´';
                
                html += `
                    <div style="margin-bottom: 15px; padding: 15px; background: ${bgColor}; border-radius: 10px; border-left: 4px solid ${isUser ? '#2196f3' : '#9c27b0'};">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>${icon} ${roleName}</strong>
                            <span style="color: #666; font-size: 0.85rem;">${new Date(msg.timestamp).toLocaleString('ko-KR')}</span>
                        </div>
                        <div style="line-height: 1.6;">${msg.content}</div>
                        ${msg.metadata ? `
                            <details style="margin-top: 10px;">
                                <summary style="cursor: pointer; color: #666; font-size: 0.85rem;">ğŸ“Š ë©”íƒ€ë°ì´í„° ë³´ê¸°</summary>
                                <pre style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; font-size: 0.8rem; overflow-x: auto;">${JSON.stringify(msg.metadata, null, 2)}</pre>
                            </details>
                        ` : ''}
                    </div>
                `;
            });
            
            memoryContent.innerHTML = html;
        }
    </script>
</body>
</html>

