<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë§ˆìŒë´„ ì„¤ë¬¸</title>
  <style>
    /* index.html: Landing + step-by-step survey experience for ë§ˆìŒë´„ */
    :root {
      --bg-gradient: linear-gradient(135deg, #7a5af8 0%, #4b8df8 100%);
      --card-bg: #ffffff;
      --text-main: #1f2a44;
      --text-sub: #5f6b7c;
      --accent-start: #7a5af8;
      --accent-end: #9c6bff;
      --accent-strong: #5a3beb;
      --pill-bg: #f4f6fb;
      --pill-border: #d7ddf0;
      --pill-active-bg: #ede8ff;
      --pill-active-border: #7a5af8;
      --button-radius: 999px;
      --transition: 0.2s ease;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--bg-gradient);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      padding: 16px;
    }

    .card {
      width: 100%;
      max-width: 960px;
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(47, 60, 92, 0.15);
      padding: 32px;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .label {
      display: inline-block;
      font-size: 13px;
      font-weight: 600;
      color: var(--accent-strong);
      background: rgba(122, 90, 248, 0.12);
      padding: 8px 12px;
      border-radius: 12px;
    }

    h1 {
      margin: 0;
      font-size: clamp(26px, 4vw, 36px);
      line-height: 1.3;
      font-weight: 800;
    }

    .subtitle {
      margin: 8px 0 0;
      font-size: 16px;
      line-height: 1.6;
      color: var(--text-sub);
    }

    .primary-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 18px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      color: #ffffff;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(122, 90, 248, 0.3);
    }

    .primary-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .cta-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    .pill-btn {
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      color: var(--text-main);
      padding: 10px 14px;
      border-radius: var(--button-radius);
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition), transform var(--transition), color var(--transition);
    }

    .pill-btn:hover {
      border-color: var(--accent-start);
      color: var(--accent-start);
      transform: translateY(-1px);
    }

    .pill-btn:active,
    .pill-btn.active {
      background: var(--pill-active-bg);
      border-color: var(--pill-active-border);
      color: var(--accent-strong);
      transform: translateY(0);
    }

    .landing-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-wrap: wrap;
    }

    .survey {
      display: none;
      flex-direction: column;
      gap: 24px;
      width: 100%;
      max-width: 760px;
      margin: 0 auto;
    }

    .survey-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .progress {
      width: 100%;
      background: #edf0f8;
      border-radius: 999px;
      height: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      width: 0;
      transition: width 0.25s ease;
    }

    .question {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .question h2 {
      margin: 0;
      font-size: clamp(22px, 3vw, 28px);
      line-height: 1.4;
    }

    .help-text {
      font-size: 14px;
      color: var(--text-sub);
    }

    .answers {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .answer-btn {
      border: 1.5px solid var(--pill-border);
      background: #fff;
      color: var(--text-main);
      padding: 12px 16px;
      border-radius: var(--button-radius);
      font-weight: 700;
      min-width: 96px;
      text-align: center;
      cursor: pointer;
      transition: background var(--transition), color var(--transition), border-color var(--transition), transform var(--transition), box-shadow var(--transition);
      box-shadow: 0 6px 16px rgba(31, 42, 68, 0.06);
    }

    .answer-btn:hover {
      border-color: var(--accent-start);
      color: var(--accent-start);
      transform: translateY(-1px);
    }

    .answer-btn.selected {
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      color: #fff;
      border-color: transparent;
      transform: translateY(0);
      box-shadow: 0 10px 28px rgba(122, 90, 248, 0.3);
    }

    .nav-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .secondary-btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid #d7ddf0;
      background: #f6f8fd;
      color: var(--text-main);
      font-weight: 700;
      cursor: pointer;
      transition: background var(--transition), color var(--transition), border-color var(--transition);
    }

    .secondary-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .secondary-btn:not(:disabled):hover {
      border-color: var(--accent-start);
      color: var(--accent-start);
    }

    .result-box {
      display: none;
      flex-direction: column;
      gap: 12px;
      text-align: center;
      background: #f6f8ff;
      border-radius: 16px;
      padding: 24px;
      color: var(--text-main);
    }

    .hidden { display: none; }

    @media (max-width: 720px) {
      .card { padding: 24px; }
      .landing-actions { justify-content: center; }
      .nav-actions { flex-direction: column; align-items: stretch; }
      .nav-actions .primary-btn, .nav-actions .secondary-btn { width: 100%; justify-content: center; }
      .survey-header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="card" id="landing">
    <span class="label">ë§ˆìŒë´„ ì˜¤í”ˆë© 1-4-1</span>
    <div>
      <h1>ì˜¤ëŠ˜ ë§ˆìŒê³¼ ë£¨í‹´, ê°€ë³ê²Œ ì ê²€í•´ë³¼ê¹Œìš”?</h1>
      <p class="subtitle">5ë¶„ ì •ë„ë©´ ëë‚˜ëŠ” ê°„ë‹¨í•œ ì„¤ë¬¸ì´ì—ìš”. ê²°ê³¼ëŠ” ì§„ë‹¨ì´ ì•„ë‹ˆë¼ ì˜¤ëŠ˜ì˜ ë§ˆìŒ ìƒíƒœë¥¼ ëŒì•„ë³´ëŠ” ì°¸ê³  ì •ë³´ë¡œë§Œ ì‚¬ìš©ë¼ìš”.</p>
    </div>
    <div class="landing-actions">
      <button class="primary-btn" onclick="startSurvey()">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
      <button class="secondary-btn" onclick="testDeepAgent()" style="padding: 12px 18px; border-radius: 14px;">ğŸ¤– Deep Agent í…ŒìŠ¤íŠ¸</button>
    </div>
    <div class="cta-container">
      <button class="pill-btn" data-pill>ì˜ˆ/ì•„ë‹ˆì˜¤ë¡œ ê°„ë‹¨íˆ ì‘ë‹µ</button>
      <button class="pill-btn" data-pill>ì˜¤ëŠ˜ ì»¨ë””ì…˜ í™•ì¸</button>
      <button class="pill-btn" data-pill>ë£¨í‹´ ì ê²€</button>
    </div>
  </div>

  <div class="card hidden" id="survey-card">
    <div class="survey" id="survey">
      <div class="survey-header">
        <div>
          <div class="label" style="background: rgba(122, 90, 248, 0.12);">ì˜¤ëŠ˜ì˜ ë§ˆìŒë´„ ì„¤ë¬¸</div>
          <div style="margin-top: 6px; font-weight: 700; color: var(--text-main);" id="progress-text">1 / 1 ë¬¸í•­</div>
        </div>
        <div style="font-weight: 700; color: var(--accent-strong);">ë£¨í‹´ê³¼ ë§ˆìŒì„ í•¨ê»˜ ëŒì•„ë´ìš” âœ¨</div>
      </div>

      <div class="progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>

      <div class="question" id="question-area">
        <h2 id="question-text"></h2>
        <p class="help-text" id="question-help"></p>
      </div>

      <div class="answers" id="answers"></div>

      <div class="nav-actions">
        <button class="secondary-btn" id="prev-btn" onclick="goPrev()">ì´ì „</button>
        <button class="primary-btn" id="next-btn" onclick="goNext()">ë‹¤ìŒ</button>
      </div>
    </div>

    <div class="result-box" id="result-box">
      <h2 style="margin: 0;">ì˜¤ëŠ˜ ë§ˆìŒë´„ ì ê²€ì´ ì™„ë£Œë˜ì—ˆì–´ìš”.</h2>
      <p style="margin: 0; color: var(--text-sub);">ë‹µë³€í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì˜ ë§ˆìŒê³¼ ë£¨í‹´ì„ ê°€ë³ê²Œ ëŒì•„ë³¼ ìˆ˜ ìˆëŠ” ì‹œê°„ì´ ë˜ì—ˆê¸¸ ë°”ë¼ìš”.</p>
      <button class="primary-btn" style="align-self: center; margin-top: 8px;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
  </div>

  <script>
    const pills = document.querySelectorAll('[data-pill]');
    pills.forEach((pill) => {
      pill.addEventListener('click', () => {
        pills.forEach((p) => p.classList.remove('active'));
        pill.classList.add('active');
      });
    });

    const questions = [
      { id: 1, text: 'ì–´ì œ ë°¤ì— 7ì‹œê°„ ì´ìƒ ì¤ë‚˜ìš”?', type: 'YES_NO' },
      { id: 2, text: 'ì˜¤ëŠ˜ì˜ ì—ë„ˆì§€ ìˆ˜ì¤€ì€ ì–´ë–¤ê°€ìš”?', type: 'SCALE_1_5', helpText: '1ì€ ê±°ì˜ ì—ë„ˆì§€ê°€ ì—†ëŠ” ìƒíƒœ, 5ëŠ” ë§¤ìš° í™œê¸°ì°¬ ìƒíƒœ' },
      { id: 3, text: 'ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ìƒê°í•˜ë©´ ë§ˆìŒì´ ì „ë°˜ì ìœ¼ë¡œ í¸ì•ˆí•œê°€ìš”?', type: 'YES_NO' },
      { id: 4, text: 'ìµœê·¼ 1ì£¼ì¼ ë™ì•ˆ ê°€ì¥ ë¶€ë‹´ë˜ì—ˆë˜ ì¼ìƒ ë£¨í‹´ì€ ì–´ëŠ ì •ë„ì˜€ë‚˜ìš”?', type: 'SCALE_1_5' }
    ];

    let currentIndex = 0;
    const answers = {};

    const landingCard = document.getElementById('landing');
    const surveyCard = document.getElementById('survey-card');
    const surveyEl = document.getElementById('survey');
    const resultBox = document.getElementById('result-box');
    const questionText = document.getElementById('question-text');
    const questionHelp = document.getElementById('question-help');
    const answersEl = document.getElementById('answers');
    const progressText = document.getElementById('progress-text');
    const progressBar = document.getElementById('progress-bar');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    const startSurvey = () => {
      landingCard.classList.add('hidden');
      surveyCard.classList.remove('hidden');
      renderQuestion();
    };

    const renderQuestion = () => {
      const question = questions[currentIndex];
      questionText.textContent = question.text;
      questionHelp.textContent = question.helpText || '';
      questionHelp.style.display = question.helpText ? 'block' : 'none';

      progressText.textContent = `${currentIndex + 1} / ${questions.length} ë¬¸í•­`;
      progressBar.style.width = `${((currentIndex + 1) / questions.length) * 100}%`;

      prevBtn.disabled = currentIndex === 0;
      nextBtn.textContent = currentIndex === questions.length - 1 ? 'ì™„ë£Œ' : 'ë‹¤ìŒ';

      answersEl.innerHTML = '';
      if (question.type === 'YES_NO') {
        ['ì˜ˆ', 'ì•„ë‹ˆì˜¤'].forEach((label) => {
          const btn = document.createElement('button');
          btn.className = 'answer-btn';
          btn.textContent = label;
          const selected = answers[question.id];
          if (selected === label) btn.classList.add('selected');
          btn.onclick = () => selectAnswer(question.id, label);
          answersEl.appendChild(btn);
        });
      } else if (question.type === 'SCALE_1_5') {
        for (let i = 1; i <= 5; i += 1) {
          const btn = document.createElement('button');
          btn.className = 'answer-btn';
          btn.textContent = i;
          const selected = answers[question.id];
          if (selected === i) btn.classList.add('selected');
          btn.onclick = () => selectAnswer(question.id, i);
          answersEl.appendChild(btn);
        }
      }
    };

    const selectAnswer = (questionId, value) => {
      answers[questionId] = value;
      Array.from(answersEl.children).forEach((btn) => {
        btn.classList.toggle('selected', btn.textContent === String(value));
      });
    };

    const goNext = () => {
      const question = questions[currentIndex];
      if (answers[question.id] === undefined) {
        alert('ë‹µë³€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”');
        return;
      }

      if (currentIndex === questions.length - 1) {
        showResult();
        return;
      }

      currentIndex += 1;
      renderQuestion();
    };

    const goPrev = () => {
      if (currentIndex === 0) return;
      currentIndex -= 1;
      renderQuestion();
    };

    const showResult = () => {
      console.log('answers', answers);
      surveyEl.style.display = 'none';
      resultBox.style.display = 'flex';
    };

    window.startSurvey = startSurvey;
    window.goPrev = goPrev;
    window.goNext = goNext;

    // ========================================================================
    // Deep Agent í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
    // ========================================================================
    const testDeepAgent = async () => {
      // 1. í† í° ì…ë ¥ ë°›ê¸°
      const token = prompt('JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš” (ë¡œê·¸ì¸ í›„ ë°›ì€ access_token):');
      if (!token) {
        alert('í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤!');
        return;
      }

      // 2. Target ì„ íƒ
      const target = prompt('Targetì„ ì…ë ¥í•˜ì„¸ìš” (HUSBAND, CHILD, FRIEND, COLLEAGUE):', 'HUSBAND');
      if (!target) return;

      // 3. Topic ì…ë ¥
      const topic = prompt('Topicì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë‚¨í¸ì´ ë°¥íˆ¬ì •ì„ í•©ë‹ˆë‹¤):', 'ë‚¨í¸ì´ ë°¥íˆ¬ì •ì„ í•©ë‹ˆë‹¤');
      if (!topic) return;

      // 4. API í˜¸ì¶œ
      console.log('Deep Agent ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì‹œì‘...');
      console.log('Target:', target);
      console.log('Topic:', topic);

      try {
        const response = await fetch('http://localhost:8000/api/service/relation-training/generate-scenario', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            target: target,
            topic: topic
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error('API ì˜¤ë¥˜:', errorData);
          alert(`API ì˜¤ë¥˜: ${errorData.detail || response.statusText}`);
          return;
        }

        const result = await response.json();
        console.log('âœ… Deep Agent ê²°ê³¼:', result);
        alert(`âœ… ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì™„ë£Œ!\n\nScenario ID: ${result.scenario_id}\nì´ë¯¸ì§€ ìˆ˜: ${result.image_count}/17\ní´ë”ëª…: ${result.folder_name}\n\nì½˜ì†”(F12)ì—ì„œ ì „ì²´ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
      } catch (error) {
        console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
        alert(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}\n\nì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš” (http://localhost:8000)`);
      }
    };

    window.testDeepAgent = testDeepAgent;
  </script>
</body>
</html>
